<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Car API Frontend - Guessing Attack Testing</title>
  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      margin: 2rem;
      background: #f5f5f5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      color: #333;
      border-bottom: 3px solid #007bff;
      padding-bottom: 0.5rem;
    }
    section {
      margin-bottom: 2rem;
      background: white;
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h2 {
      color: #555;
      margin-top: 0;
    }
    .input-group {
      margin-bottom: 1rem;
    }
    label {
      display: block;
      margin-bottom: 0.25rem;
      color: #666;
      font-weight: 500;
    }
    input, textarea, select { 
      display: block; 
      width: 100%;
      max-width: 400px;
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    textarea {
      font-family: 'Courier New', monospace;
      min-height: 120px;
    }
    button { 
      margin-top: 1rem;
      padding: 0.75rem 1.5rem;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
    }
    button:hover {
      background: #0056b3;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    pre { 
      background: #f8f9fa; 
      padding: 1rem; 
      white-space: pre-wrap;
      border-radius: 4px;
      border: 1px solid #dee2e6;
      max-height: 600px;
      overflow-y: auto;
      font-size: 13px;
    }
    .error {
      color: #dc3545;
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      padding: 0.75rem;
      border-radius: 4px;
      margin-top: 1rem;
      max-width: 400px;
    }
    .success {
      color: #155724;
      background: #d4edda;
      border: 1px solid #c3e6cb;
      padding: 0.75rem;
      border-radius: 4px;
      margin-top: 1rem;
      max-width: 400px;
    }
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }
    .optional-label {
      color: #999;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸš— Car API Frontend - Guessing Attack Testing</h1>

    <!-- Get Car Commands Section -->
    <section id="get-car-section">
      <h2>Fetch Car Commands</h2>
      <form id="get-car-form">
        <div class="grid-2">
          <div class="input-group">
            <label for="gc-manufacturer">Manufacturer</label>
            <input type="text" id="gc-manufacturer" required />
          </div>
          <div class="input-group">
            <label for="gc-model">Model</label>
            <input type="text" id="gc-model" required />
          </div>
        </div>
        <div class="grid-2">
          <div class="input-group">
            <label for="gc-year">Year <span class="optional-label">(optional)</span></label>
            <input type="number" id="gc-year" min="1900" max="2100" />
          </div>
          <div class="input-group">
            <label for="gc-region">Country/Region <span class="optional-label">(optional)</span></label>
            <input type="text" id="gc-region" />
          </div>
        </div>
        <div class="input-group">
          <label for="gc-type">Type <span class="optional-label">(optional)</span></label>
          <input type="text" id="gc-type" />
        </div>
        <button type="submit">Get Commands</button>
      </form>
      <div id="get-car-error" class="error" style="display:none;"></div>
      <pre id="get-car-result" style="display:none;"></pre>
    </section>

    <!-- Guessing Attack Section -->
    <section id="guessing-attack-section">
      <h2>Guessing Attack Strategy</h2>
      <form id="guessing-attack-form">
        <div class="grid-2">
          <div class="input-group">
            <label for="ga-manufacturer">Manufacturer</label>
            <input type="text" id="ga-manufacturer" required />
          </div>
          <div class="input-group">
            <label for="ga-model">Model</label>
            <input type="text" id="ga-model" required />
          </div>
        </div>
        <div class="grid-2">
          <div class="input-group">
            <label for="ga-year">Year <span class="optional-label">(optional)</span></label>
            <input type="number" id="ga-year" min="1900" max="2100" />
          </div>
          <div class="input-group">
            <label for="ga-region">Country/Region <span class="optional-label">(optional)</span></label>
            <input type="text" id="ga-region" />
          </div>
        </div>
        <div class="grid-2">
          <div class="input-group">
            <label for="ga-type">Type <span class="optional-label">(optional)</span></label>
            <input type="text" id="ga-type" />
          </div>
          <div class="input-group">
            <label for="ga-field">Field <span class="optional-label">(filter one of Pack_SOC, Pack_Voltage, Pack_SOH)</span></label>
            <select id="ga-field">
              <option value="">(all)</option>
              <option>Pack_SOC</option>
              <option>Pack_Voltage</option>
              <option>Pack_SOH</option>
            </select>
          </div>
        </div>
        <div class="input-group">
          <label for="ga-new-attr">New Car Attributes <span class="optional-label">(optional)</span></label>
          <input type="text" id="ga-new-attr" placeholder="Custom base identifier" />
        </div>
        <div class="input-group">
          <label for="ga-target-json">Target JSON Array <span class="optional-label">(one object per field if no filter)</span></label>
          <textarea id="ga-target-json" required placeholder='[{"request_id": "7E4", "response_id": "7EC", "command": "220105"}, ...]'></textarea>
        </div>
        <div class="grid-2">
          <div class="input-group">
            <label for="ga-success-threshold">Success Threshold <span class="optional-label">(0.0â€“1.0)</span></label>
            <input type="number" step="0.01" id="ga-success-threshold" value="0.80" min="0" max="1" />
          </div>
          <div class="input-group">
            <label for="ga-display-threshold">Display Threshold <span class="optional-label">(0.0â€“1.0)</span></label>
            <input type="number" step="0.01" id="ga-display-threshold" value="0.50" min="0" max="1" />
          </div>
        </div>
        <button type="submit">Run Guessing Attack</button>
      </form>
      <div id="ga-error" class="error" style="display:none;"></div>
      <pre id="ga-result" style="display:none;"></pre>
    </section>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const apiBase = window.location.origin;

      // --- Get Car Commands ---
      const getForm = document.getElementById('get-car-form');
      const getError = document.getElementById('get-car-error');
      const getResult = document.getElementById('get-car-result');

      getForm.addEventListener('submit', async e => {
        e.preventDefault();
        getError.style.display = 'none';
        getResult.style.display = 'none';

        const manufacturer = document.getElementById('gc-manufacturer').value.trim();
        const model = document.getElementById('gc-model').value.trim();
        const year = document.getElementById('gc-year').value;
        const region = document.getElementById('gc-region').value.trim();
        const type = document.getElementById('gc-type').value.trim();

        let url = `${apiBase}/car/${encodeURIComponent(manufacturer)}/${encodeURIComponent(model)}`;
        const params = new URLSearchParams();
        if (year) params.append('year', year);
        if (region) params.append('country_region', region);
        if (type) params.append('type_', type);
        if ([...params].length) url += `?${params}`;

        try {
          const resp = await fetch(url);
          if (!resp.ok) throw resp;
          const data = await resp.json();
          getResult.textContent = JSON.stringify(data, null, 2);
          getResult.style.display = 'block';
        } catch (err) {
          let msg = 'Unknown error';
          if (err.json) {
            const body = await err.json();
            msg = body.detail || JSON.stringify(body);
          }
          getError.textContent = msg;
          getError.style.display = 'block';
        }
      });

      // --- Guessing Attack ---
      const gaForm = document.getElementById('guessing-attack-form');
      const gaError = document.getElementById('ga-error');
      const gaResult = document.getElementById('ga-result');

      gaForm.addEventListener('submit', async e => {
        e.preventDefault();
        gaError.style.display = 'none';
        gaResult.style.display = 'none';

        const payload = {
          manufacturer: document.getElementById('ga-manufacturer').value.trim(),
          model: document.getElementById('ga-model').value.trim(),
          year: document.getElementById('ga-year').value || undefined,
          country_region: document.getElementById('ga-region').value.trim() || undefined,
          type_: document.getElementById('ga-type').value.trim() || undefined,
          new_car_attributes: document.getElementById('ga-new-attr').value.trim() || undefined,
          target_json_arr: [],
          field: document.getElementById('ga-field').value || undefined
        };

        try {
          payload.target_json_arr = JSON.parse(document.getElementById('ga-target-json').value);
          const successT = parseFloat(document.getElementById('ga-success-threshold').value);
          const displayT = parseFloat(document.getElementById('ga-display-threshold').value);

          const resp = await fetch(`${apiBase}/guessing-attack`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
          });
          if (!resp.ok) throw { response: resp, successT, displayT };

          const data = await resp.json();
          gaResult.textContent = JSON.stringify(data, null, 2);
          gaResult.style.display = 'block';
        } catch (err) {
          let msg = 'Unknown error';
          if (err.response && err.response.json) {
            const body = await err.response.json();
            msg = body.detail || JSON.stringify(body);
          } else if (err instanceof SyntaxError) {
            msg = 'Invalid JSON in target array.';
          }
          gaError.textContent = msg;
          gaError.style.display = 'block';
        }
      });
    });
  </script>
</body>
</html>
```
